@{
    Layout = "_stafflayout";
}
<div style="margin-top: 20px; align-content:center">
    <a href="@Url.Action("ReceptionistDashboard", "StaffHome")" class="btn btn-secondary mb-3"
       style="background-color: #6c757d; color: white; padding: 10px 15px;
              border-radius: 5px; text-decoration: none; display: inline-block;">
        🔙 Back to Dashboard
    </a>
</div>

<div class="container mt-4">
    <div class="card p-4">
        <h3 class="text-center mb-4">🚪 Visitor Records</h3>

        <!-- Add Visitor Button -->
        <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addVisitorModal">➕ Add Visitor</button>

        <!-- Search Bar -->
        <input type="text" id="searchInput" class="form-control mb-3" placeholder="🔍 Search by Name or Patient">

        <div class="table-responsive">
            <table class="table table-bordered" id="visitorRecordsTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">Visitor Name ⬆⬇</th>
                        <th onclick="sortTable(1)">Patient Name ⬆⬇</th>
                        <th>Relationship</th>
                        <th onclick="sortTable(3)">Visit Date ⬆⬇</th>
                        <th onclick="sortTable(4)">Check-In ⬆⬇</th>
                        <th>Check-Out</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="visitorTable">
                    <tr>
                        <td>Michael Johnson</td>
                        <td>John Doe</td>
                        <td>Brother</td>
                        <td>2025-03-12</td>
                        <td>10:00 AM</td>
                        <td>12:00 PM</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-warning">✏ Edit</a>
                            <a href="#" class="btn btn-sm btn-danger">❌ Remove</a>
                        </td>
                    </tr>
                    <tr>
                        <td>Emily Watson</td>
                        <td>Jane Smith</td>
                        <td>Friend</td>
                        <td>2025-03-12</td>
                        <td>2:00 PM</td>
                        <td>4:00 PM</td>
                        <td>
                            <a href="#" class="btn btn-sm btn-warning">✏ Edit</a>
                            <a href="#" class="btn btn-sm btn-danger">❌ Remove</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Add Visitor Modal -->
<div class="modal fade" id="addVisitorModal" tabindex="-1" aria-labelledby="addVisitorLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addVisitorLabel">➕ Add Visitor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addVisitorForm">
                    <div class="mb-3">
                        <label class="form-label">Visitor Name</label>
                        <input type="text" class="form-control" id="visitorName" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Patient Name</label>
                        <input type="text" class="form-control" id="patientName" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Relationship</label>
                        <select class="form-control" id="relationship">
                            <option value="">Select Relationship</option>
                            <option>Parent</option>
                            <option>Sibling</option>
                            <option>Friend</option>
                            <option>Relative</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Visit Date</label>
                        <input type="date" class="form-control" id="visitDate" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Check-In Time</label>
                        <input type="time" class="form-control" id="checkIn" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Check-Out Time</label>
                        <input type="time" class="form-control" id="checkOut" required />
                    </div>
                    <button type="submit" class="btn btn-success">✅ Save Visitor</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Search functionality
    document.getElementById("searchInput").addEventListener("keyup", function () {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll("#visitorTable tr");
        rows.forEach(row => {
            let visitorName = row.cells[0].textContent.toLowerCase();
            let patientName = row.cells[1].textContent.toLowerCase();
            row.style.display = visitorName.includes(filter) || patientName.includes(filter) ? "" : "none";
        });
    });

    // Sorting function (sorts table by column index)
    function sortTable(colIndex) {
        let table = document.getElementById("visitorRecordsTable").getElementsByTagName("tbody")[0];
        let rows = Array.from(table.rows);
        let sortedRows = rows.sort((a, b) => {
            let cellA = a.cells[colIndex].textContent.trim();
            let cellB = b.cells[colIndex].textContent.trim();

            if (!isNaN(Date.parse(cellA)) && !isNaN(Date.parse(cellB))) {
                return new Date(cellA) - new Date(cellB);
            }
            if (!isNaN(cellA) && !isNaN(cellB)) {
                return Number(cellA) - Number(cellB);
            }
            return cellA.localeCompare(cellB);
        });

        table.innerHTML = "";
        sortedRows.forEach(row => table.appendChild(row));
    }

    // Form validation before submission
    document.getElementById("addVisitorForm").addEventListener("submit", function (e) {
        e.preventDefault();
        let visitorName = document.getElementById("visitorName").value.trim();
        let patientName = document.getElementById("patientName").value.trim();
        let relationship = document.getElementById("relationship").value.trim();
        let visitDate = document.getElementById("visitDate").value;
        let checkIn = document.getElementById("checkIn").value;
        let checkOut = document.getElementById("checkOut").value;

        if (!visitorName || !patientName || !relationship || !visitDate || !checkIn || !checkOut) {
            alert("⚠ Please fill in all fields!");
            return;
        }

        alert("✅ Visitor added successfully!");
        document.getElementById("addVisitorForm").reset();
        let modal = bootstrap.Modal.getInstance(document.getElementById('addVisitorModal'));
        modal.hide();
    });
</script>
