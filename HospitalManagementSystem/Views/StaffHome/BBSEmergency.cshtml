@{
    ViewData["Title"] = "Emergency Blood Requests";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}

<!-- Back to Dashboard -->
<a asp-controller="StaffHome" asp-action="BloodBankStaffDashboard" class="btn btn-secondary my-2">⬅ Back to Dashboard</a>

<h2 class="text-center my-3">🚨 Emergency Blood Requests</h2>

<div class="container" style="margin-bottom:30px">
    <div class="d-flex flex-wrap justify-content-between mb-3 gap-2">
        <input type="text" id="searchInput" class="form-control flex-grow-1 w-auto" placeholder="🔍 Search">
        <button class="btn btn-danger" onclick="openModal('addEmergencyRequestModal')">➕ Urgent Request</button>
    </div>

    <!-- Table Scroll Wrapper -->
    <div class="table-responsive" style="max-height: 400px; overflow-y: auto; ">
        <table class="table table-bordered table-striped text-center">
            <thead class="table-danger">
                <tr>
                    <th>#</th>
                    <th>Patient/Hospital</th>
                    <th>Blood Type</th>
                    <th>Required Units</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>City Trauma Center</td>
                    <td>O-</td>
                    <td>5</td>
                    <td><span class="badge bg-danger">🔴 Critical</span></td>
                    <td><span class="badge bg-warning">Pending</span></td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="confirmApprove()">✅ Approve</button>
                        <button class="btn btn-sm btn-danger" onclick="confirmReject()">❌ Reject</button>
                        <button class="btn btn-sm btn-info" onclick="openModal('dispatchBloodModal')">🚑 Dispatch</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Jane Doe</td>
                    <td>A+</td>
                    <td>3</td>
                    <td><span class="badge bg-warning">🟠 High</span></td>
                    <td><span class="badge bg-success">Approved</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="openModal('viewEmergencyRequestModal')">👁 View</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Reusable Modal Structure -->
<div id="modalContainer" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function openModal(contentId) {
        let content = {
            addEmergencyRequestModal: `
                <h4>➕ Add Emergency Blood Request</h4>
                <label>Patient/Hospital:</label>
                <input type="text" class="form-control" placeholder="Enter name">
                <label>Blood Type:</label>
                <select class="form-control">
                    <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                    <option>O+</option><option>O-</option><option>AB+</option><option>AB-</option>
                </select>
                <label>Required Units:</label>
                <input type="number" class="form-control" min="1">
                <label>Priority:</label>
                <select class="form-control">
                    <option>🔴 Critical</option><option>🟠 High</option><option>🟢 Normal</option>
                </select>
                <button class="btn btn-success mt-3">Save Request</button>
            `,
            dispatchBloodModal: `
                <h4>🚑 Dispatch Blood</h4>
                <p>Enter dispatch details:</p>
                <label>Dispatch Vehicle:</label>
                <input type="text" class="form-control" placeholder="Enter vehicle number">
                <label>Expected Delivery Time:</label>
                <input type="time" class="form-control">
                <button class="btn btn-info mt-3">Dispatch</button>
            `,
            viewEmergencyRequestModal: `
                <h4>👁 View Emergency Request</h4>
                <p><strong>Patient/Hospital:</strong> Jane Doe</p>
                <p><strong>Blood Type:</strong> A+</p>
                <p><strong>Required Units:</strong> 3</p>
                <p><strong>Priority:</strong> 🟠 High</p>
                <p><strong>Status:</strong> ✅ Approved</p>
            `
        };
        document.getElementById("modalBody").innerHTML = content[contentId];
        document.getElementById("modalContainer").style.display = "flex";
    }

    function closeModal() {
        document.getElementById("modalContainer").style.display = "none";
    }

    function confirmApprove() {
        if (confirm("Are you sure you want to approve this request?")) {
            alert("Request Approved ✅");
        }
    }

    function confirmReject() {
        if (confirm("Are you sure you want to reject this request?")) {
            let reason = prompt("Enter reason for rejection:");
            if (reason) {
                alert("Request Rejected ❌\nReason: " + reason);
            }
        }
    }
</script>

<!-- CSS -->
<style>
    /* General Styles */
    .container {
        max-width: 1000px;
        margin: auto;
    }

    /* Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        max-width: 90%;
        text-align: center;
        position: relative;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
    }

    /* Table Responsiveness */
    .table-responsive {
        overflow-x: auto;
    }

    /* Mobile Optimizations */
    @@media (max-width: 768px) {
        .d-flex

    {
        flex-direction: column;
        align-items: stretch;
    }

    .btn {
        font-size: 14px;
        padding: 8px 12px;
        margin-top: 5px;
    }

    input, select {
        font-size: 14px;
        padding: 8px;
    }

    }

    @@media (max-width: 480px) {
        .modal-content

    {
        width: 95%;
        padding: 10px;
    }

    .btn {
        width: 100%;
    }

    }
</style>
