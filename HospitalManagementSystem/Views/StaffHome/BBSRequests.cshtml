@{
    ViewData["Title"] = "Blood Requests";
    Layout = "~/Views/Shared/_StaffLayout.cshtml";
}


<a asp-controller="StaffHome" asp-action="BloodBankStaffDashboard" class="btn btn-secondary">⬅ Back to Dashboard</a>


<h2 class="text-center my-3">🆘 Blood Requests</h2>

<div class="container">
    <div class="d-flex justify-content-between mb-3">
        <input type="text" id="searchInput" class="form-control w-25" placeholder="🔍 Search Patient/Hospital">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRequestModal">➕ New Request</button>
    </div>

    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
        <table class="table table-bordered table-striped text-center" id="requestTable">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Patient/Hospital</th>
                    <th>Blood Type</th>
                    <th>Requested Units</th>
                    <th>Urgency</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>City Hospital</td>
                    <td>A+</td>
                    <td>3</td>
                    <td><span class="badge bg-danger">🔴 Critical</span></td>
                    <td><span class="badge bg-warning">Pending</span></td>
                    <td>
                        <button class="btn btn-sm btn-success" onclick="confirmApprove()">✅ Approve</button>
                        <button class="btn btn-sm btn-danger" onclick="confirmReject()">❌ Reject</button>
                        <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#editRequestModal">✏ Edit</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>John Doe</td>
                    <td>O-</td>
                    <td>2</td>
                    <td><span class="badge bg-warning">🟠 High</span></td>
                    <td><span class="badge bg-success">Approved</span></td>
                    <td>
                        <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#viewRequestModal">👁 View</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Blood Request Modal -->
<div class="modal fade" id="addRequestModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <div class="modal-header">
                <h5 class="modal-title">➕ Add Blood Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <label>Patient/Hospital:</label>
                <input type="text" class="form-control" placeholder="Enter name">
                <label>Blood Type:</label>
                <select class="form-control">
                    <option>A+</option>
                    <option>A-</option>
                    <option>B+</option>
                    <option>B-</option>
                    <option>O+</option>
                    <option>O-</option>
                    <option>AB+</option>
                    <option>AB-</option>
                </select>
                <label>Requested Units:</label>
                <input type="number" class="form-control" min="1">
                <label>Urgency:</label>
                <select class="form-control">
                    <option>🔴 Critical</option>
                    <option>🟠 High</option>
                    <option>🟢 Normal</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="confirmNewRequest()">Save Request</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Blood Request Modal -->
<div class="modal fade" id="editRequestModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <div class="modal-header">
                <h5 class="modal-title">✏ Edit Blood Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <label>Patient/Hospital:</label>
                <input type="text" class="form-control" value="City Hospital">
                <label>Blood Type:</label>
                <select class="form-control">
                    <option selected>A+</option>
                    <option>A-</option>
                    <option>B+</option>
                    <option>B-</option>
                    <option>O+</option>
                    <option>O-</option>
                    <option>AB+</option>
                    <option>AB-</option>
                </select>
                <label>Requested Units:</label>
                <input type="number" class="form-control" value="3">
                <label>Urgency:</label>
                <select class="form-control">
                    <option selected>🔴 Critical</option>
                    <option>🟠 High</option>
                    <option>🟢 Normal</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning">Update Request</button>
            </div>
        </div>
    </div>
</div>

<!-- View Blood Request Modal -->
<div class="modal fade" id="viewRequestModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
            <div class="modal-header">
                <h5 class="modal-title">👁 View Blood Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>Patient/Hospital:</strong> John Doe</p>
                <p><strong>Blood Type:</strong> O-</p>
                <p><strong>Requested Units:</strong> 2</p>
                <p><strong>Urgency:</strong> 🟠 High</p>
                <p><strong>Status:</strong> ✅ Approved</p>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Search and Confirmations -->
<script>
    document.getElementById("searchInput").addEventListener("keyup", function () {
        let filter = this.value.toLowerCase();
        document.querySelectorAll("#requestTable tbody tr").forEach(row => {
            row.style.display = row.cells[1].textContent.toLowerCase().includes(filter) ? "" : "none";
        });
    });

    function confirmApprove() {
        if (confirm("Are you sure you want to approve this request?")) {
            alert("Request Approved ✅");
        }
    }

    function confirmReject() {
        if (confirm("Are you sure you want to reject this request?")) {
            let reason = prompt("Enter reason for rejection:");
            if (reason) {
                alert("Request Rejected ❌\nReason: " + reason);
            }
        }
    }

    function confirmNewRequest() {
        if (confirm("Are you sure you want to add this new request?")) {
            alert("New Blood Request Added ✅");
        }
    }
</script>
